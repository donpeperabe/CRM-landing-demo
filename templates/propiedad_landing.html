{% extends "base.html" %}
{% block content %}
    <!-- GALERÍA SIMPLIFICADA -->
    <div class="gallery">
        {% if propiedad.imagenes and propiedad.imagenes|length > 0 %}
            {% for img in propiedad.imagenes %}
                <img src="{{ url_for('static', filename=img) }}" 
                     alt="{{ propiedad.titulo_es }}" 
                     onclick="openModal(this)"
                     loading="lazy">
            {% endfor %}
        {% else %}
            <div style="grid-column:1/-1;text-align:center;padding:40px;color:#666">
                <i class="fas fa-image" style="font-size:3rem;margin-bottom:15px"></i>
                <p>No hay imágenes disponibles</p>
            </div>
        {% endif %}
    </div>

    <!-- MODAL SIMPLIFICADO -->
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <div class="info">
        <!-- CONTENIDO EN ESPAÑOL -->
        <div id="content-espanol" class="language-content">
            <h2>{{ propiedad.titulo_es }}</h2>
            
            <div class="property-meta">
                {% if propiedad.ubicacion %}
                <span><i class="fas fa-map-marker-alt"></i> {{ propiedad.ubicacion }}</span>
                {% endif %}
                <p>
                <!-- CAMBIO AQUÍ: Usamos tipo_es en lugar de tipo -->
                {% if propiedad.tipo_es %}
                <span><i class="fas fa-home"></i> {{ propiedad.tipo_es|title }}</span></p>
                {% endif %}
            </div>
            
            <p class="desc">
                {% if propiedad.descripcion_es %}
                    {{ propiedad.descripcion_es }}
                {% else %}
                    Propiedad de calidad en excelente ubicación.
                {% endif %}
            </p>
            
            {% if propiedad.precio %}
            <p class="price">{{ propiedad.precio }}</p>
            {% endif %}
            
            <!-- BOTONES CORREGIDOS -->
            <div style="display:flex;flex-direction:column;gap:15px;align-items:center;margin-top:25px">
                {% if propiedad.whatsapp %}
                <a href="https://wa.me/{{ propiedad.whatsapp }}?text=Hola, estoy interesado en la propiedad: {{ propiedad.titulo_es }}" 
                   target="_blank" class="btn-whatsapp" onclick="trackWhatsAppClick()">
                    <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                </a>
                {% endif %}
                
                <a href="{{ url_for('prospect_form') }}?source=landing&propiedad_id={{ propiedad.id }}" 
                   class="btn-prospecto">
                    <i class="fas fa-envelope"></i> Dejar información
                </a>
                <div style="text-align: center; margin-top: 30px;">
                    <a href="{{ url_for('propiedades_list') }}" class="btn-primary btn-back">
                        <i class="fas fa-arrow-left"></i> Volver
                    </a>
                </div>
            </div>
        </div>
        
        <!-- CONTENIDO EN INGLÉS -->
        <div id="content-ingles" class="language-content" style="display:none">
            <h2>{{ propiedad.titulo_en }}</h2>
            
            <div class="property-meta">
                {% if propiedad.ubicacion %}
                <span><i class="fas fa-map-marker-alt"></i> {{ propiedad.ubicacion }}</span>
                {% endif %}
                
                <p><!-- CAMBIO AQUÍ: Usamos tipo_en en lugar de tipo -->
                {% if propiedad.tipo_en %}
                <span><i class="fas fa-home"></i> {{ propiedad.tipo_en|title }}</span></p>
                {% endif %}
            </div>
            
            <p class="desc">
                {% if propiedad.descripcion_en %}
                    {{ propiedad.descripcion_en }}
                {% else %}
                    Quality property in excellent location.
                {% endif %}
            </p>
            
            {% if propiedad.precio %}
            <p class="price">{{ propiedad.precio }}</p>
            {% endif %}
            
            <!-- BOTONES CORREGIDOS -->
            <div style="display:flex;flex-direction:column;gap:15px;align-items:center;margin-top:25px">
                {% if propiedad.whatsapp %}
                <a href="https://wa.me/{{ propiedad.whatsapp }}?text=Hello, I'm interested in the property: {{ propiedad.titulo_en }}" 
                   target="_blank" class="btn-whatsapp" onclick="trackWhatsAppClick()">
                    <i class="fab fa-whatsapp"></i> Contact via WhatsApp
                </a>
                {% endif %}
                
                <a href="{{ url_for('prospect_form') }}?source=landing&propiedad_id={{ propiedad.id }}" 
                   class="btn-prospecto">
                    <i class="fas fa-envelope"></i> Leave contact information
                </a>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <a href="{{ url_for('propiedades_list') }}" class="btn-primary btn-back">
                    <i class="fas fa-arrow-left"></i> Back
                </a>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    // Solo funcionalidades específicas de esta página
    document.addEventListener('DOMContentLoaded', function() {
        // Modal functionality
        document.onkeydown = function(e) {
            if (e.key === 'Escape') closeModal();
        };

        document.getElementById('imageModal').onclick = function(e) {
            if (e.target === this) closeModal();
        };
    });

    // Modal functions
    function openModal(img) {
        document.getElementById('modalImage').src = img.src;
        document.getElementById('imageModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('imageModal').style.display = 'none';
    }
</script>
{% endblock %}