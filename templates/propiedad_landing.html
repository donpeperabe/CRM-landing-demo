<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ propiedad.titulo_es }} - Terra Zen Inmobiliaria</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="card">
        <div class="card-header">
            <a href="{{ url_for('propiedades_list') }}" title="Ver todas las propiedades">
                <img src="{{ url_for('static', filename='images/logo.png') }}" 
                     alt="Terra Zen Inmobiliaria" 
                     class="logo-img">
            </a>
        </div>

        <!-- BOTÓN DE CAMBIO DE IDIOMA -->
        <div class="language-switcher">
            <button id="btn-espanol" class="lang-btn active">Español</button>
            <button id="btn-ingles" class="lang-btn">English</button>
        </div>

        <!-- GALERÍA DINÁMICA CORREGIDA -->
        <div class="gallery">
            {% if propiedad.imagenes and propiedad.imagenes|length > 0 %}
                {% for img in propiedad.imagenes %}
                    <img src="{{ url_for('static', filename=img) }}" 
                         alt="{{ propiedad.titulo_es }}" 
                         onerror="this.src='/static/images/placeholder.jpg'">
                {% endfor %}
            {% else %}
                <div style="text-align: center; padding: 40px; color: #666; width: 100%;">
                    <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <p>No hay imágenes disponibles para esta propiedad</p>
                </div>
            {% endif %}
        </div>

        <div class="info">
            <!-- CONTENIDO EN ESPAÑOL -->
            <div id="content-espanol" class="language-content">
                <h2>{{ propiedad.titulo_es }}</h2>
                
                <!-- Información adicional de la propiedad -->
                <div class="property-meta">
                    {% if propiedad.ubicacion %}
                    <span><i class="fas fa-map-marker-alt"></i> {{ propiedad.ubicacion }}</span>
                    {% endif %}
                    {% if propiedad.tipo %}
                    <span><i class="fas fa-home"></i> {{ propiedad.tipo|title }}</span>
                    {% endif %}
                    {% if propiedad.estado %}
                    <span><i class="fas fa-info-circle"></i> {{ propiedad.estado|title }}</span>
                    {% endif %}
                </div>
                
                <p class="desc">
                    {% if propiedad.descripcion_es %}
                        {{ propiedad.descripcion_es }}
                    {% else %}
                        Propiedad de calidad en excelente ubicación. Contáctanos para más información.
                    {% endif %}
                </p>
                
                {% if propiedad.precio %}
                <p class="price">{{ propiedad.precio }}</p>
                {% endif %}
                
                <!-- Botones de acción -->
                <div style="display: flex; flex-direction: column; gap: 15px; align-items: center; margin-top: 25px;">
                    {% if propiedad.whatsapp %}
                    <a href="https://wa.me/{{ propiedad.whatsapp }}?text=Hola%20estoy%20interesado%20en%20la%20propiedad: {{ propiedad.titulo_es | urlencode }}" 
                       target="_blank" class="btn-whatsapp"
                       onclick="trackContact('whatsapp')">
                        <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('prospect_form') }}?source=landing&propiedad_id={{ propiedad.id }}" 
                       class="btn-prospecto"
                       onclick="trackContact('form')">
                        <i class="fas fa-envelope"></i> Dejar información de contacto
                    </a>
                </div>
                
                <!-- BOTONES DE REDES SOCIALES - ESPAÑOL -->
                <div class="social-media">
                    <p>¿Conoces a alguien que le interese? Comparte:</p>
                    <div class="social-buttons">
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.url | urlencode }}" 
                           target="_blank" class="social-btn fb"
                           onclick="trackSocial('facebook')">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url | urlencode }}" 
                           target="_blank" class="social-btn in"
                           onclick="trackSocial('linkedin')">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="#" class="social-btn tt"
                           onclick="shareTwitter('{{ propiedad.titulo_es }}', '{{ request.url }}')">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://api.whatsapp.com/send?text=Mira%20esta%20propiedad:%20{{ propiedad.titulo_es | urlencode }}%20{{ request.url | urlencode }}" 
                           target="_blank" class="social-btn wa"
                           onclick="trackSocial('whatsapp_share')">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- CONTENIDO EN INGLÉS -->
            <div id="content-ingles" class="language-content" style="display: none;">
                <h2>{{ propiedad.titulo_en }}</h2>
                
                <!-- Información adicional de la propiedad -->
                <div class="property-meta">
                    {% if propiedad.ubicacion %}
                    <span><i class="fas fa-map-marker-alt"></i> {{ propiedad.ubicacion }}</span>
                    {% endif %}
                    {% if propiedad.tipo %}
                    <span><i class="fas fa-home"></i> {{ propiedad.tipo|title }}</span>
                    {% endif %}
                    {% if propiedad.estado %}
                    <span><i class="fas fa-info-circle"></i> {{ propiedad.estado|title }}</span>
                    {% endif %}
                </div>
                
                <p class="desc">
                    {% if propiedad.descripcion_en %}
                        {{ propiedad.descripcion_en }}
                    {% else %}
                        Quality property in excellent location. Contact us for more information.
                    {% endif %}
                </p>
                
                {% if propiedad.precio %}
                <p class="price">{{ propiedad.precio }}</p>
                {% endif %}
                
                <!-- Botones de acción -->
                <div style="display: flex; flex-direction: column; gap: 15px; align-items: center; margin-top: 25px;">
                    {% if propiedad.whatsapp %}
                    <a href="https://wa.me/{{ propiedad.whatsapp }}?text=Hello%20I'm%20interested%20in%20the%20property: {{ propiedad.titulo_en | urlencode }}" 
                       target="_blank" class="btn-whatsapp"
                       onclick="trackContact('whatsapp')">
                        <i class="fab fa-whatsapp"></i> Contact via WhatsApp
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('prospect_form') }}?source=landing&propiedad_id={{ propiedad.id }}" 
                       class="btn-prospecto"
                       onclick="trackContact('form')">
                        <i class="fas fa-envelope"></i> Leave contact information
                    </a>
                </div>
                
                <!-- BOTONES DE REDES SOCIALES - INGLÉS -->
                <div class="social-media">
                    <p>Know someone who might be interested? Share:</p>
                    <div class="social-buttons">
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.url | urlencode }}" 
                           target="_blank" class="social-btn fb"
                           onclick="trackSocial('facebook')">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url | urlencode }}" 
                           target="_blank" class="social-btn in"
                           onclick="trackSocial('linkedin')">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="#" class="social-btn tt"
                           onclick="shareTwitter('{{ propiedad.titulo_en }}', '{{ request.url }}')">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20property:%20{{ propiedad.titulo_en | urlencode }}%20{{ request.url | urlencode }}" 
                           target="_blank" class="social-btn wa"
                           onclick="trackSocial('whatsapp_share')">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Función para cambiar idioma via AJAX
        function setLanguage(lang) {
            fetch('/set_language/' + lang)
                .then(response => {
                    showLanguage(lang);
                })
                .catch(error => {
                    console.error('Error:', error);
                    showLanguage(lang);
                });
        }

        // JavaScript para cambiar idiomas
        document.getElementById('btn-espanol').addEventListener('click', function() {
            setLanguage('espanol');
        });

        document.getElementById('btn-ingles').addEventListener('click', function() {
            setLanguage('ingles');
        });

        function showLanguage(lang) {
            // Ocultar todos los contenidos
            document.querySelectorAll('.language-content').forEach(function(content) {
                content.style.display = 'none';
            });
            
            // Mostrar el contenido seleccionado
            document.getElementById('content-' + lang).style.display = 'block';
            
            // Actualizar botones activos
            document.querySelectorAll('.lang-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            document.getElementById('btn-' + lang).classList.add('active');
        }

        // Funciones de tracking SIMPLIFICADAS
        function trackContact(method) {
            console.log('Contact method:', method);
            // Aquí podrías enviar a Google Analytics
        }

        function trackSocial(network) {
            console.log('Shared on:', network);
            // Aquí podrías enviar a Google Analytics
        }

        function shareTwitter(title, url) {
            const text = `Mira esta propiedad: ${title}`;
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            window.open(twitterUrl, '_blank');
            trackSocial('twitter');
        }

        // Inicializar con el idioma de la sesión
        document.addEventListener('DOMContentLoaded', function() {
            showLanguage('espanol');
        });
    </script>

    <style>
        /* Estilos adicionales para el template dinámico */
        .social-btn.wa {
            background: #25d366;
        }
        
        .social-btn.tt {
            background: #1da1f2;
        }
        
        .property-meta {
            color: #ccc;
            font-size: 0.95rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .property-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: #2a2a2a;
            border-radius: 8px;
            border: 1px solid #444;
        }
        
        @media (max-width: 768px) {
            .property-meta {
                flex-direction: column;
                gap: 8px;
            }
            
            .property-meta span {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</body>
</html>