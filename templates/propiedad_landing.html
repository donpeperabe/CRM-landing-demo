<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ propiedad.titulo_es }} - Terra Zen Inmobiliaria</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ESTILOS OPTIMIZADOS PARA GALERÍA */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin: 15px 0;
            padding: 0 15px;
        }
        
        .gallery img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #333;
            cursor: pointer;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
        }
        
        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 25px;
            color: #fff;
            font-size: 30px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: 1fr;
                padding: 0 10px;
            }
            
            .gallery img {
                height: 180px;
            }
        }
    </style>
</head>
<body>
    <div class="card">
        <div class="card-header">
            <a href="{{ url_for('propiedades_list') }}" title="Ver todas las propiedades">
                <img src="{{ url_for('static', filename='images/logo.png') }}" 
                     alt="Terra Zen Inmobiliaria" 
                     class="logo-img">
            </a>
        </div>

        <!-- BOTÓN DE CAMBIO DE IDIOMA -->
        <div class="language-switcher">
            <button id="btn-espanol" class="lang-btn active">Español</button>
            <button id="btn-ingles" class="lang-btn">English</button>
        </div>

        <!-- GALERÍA SIMPLIFICADA -->
        <div class="gallery">
            {% if propiedad.imagenes and propiedad.imagenes|length > 0 %}
                {% for img in propiedad.imagenes %}
                    <img src="{{ url_for('static', filename=img) }}" 
                         alt="{{ propiedad.titulo_es }}" 
                         onclick="openModal(this)"
                         loading="lazy">
                {% endfor %}
            {% else %}
                <div style="grid-column:1/-1;text-align:center;padding:40px;color:#666">
                    <i class="fas fa-image" style="font-size:3rem;margin-bottom:15px"></i>
                    <p>No hay imágenes disponibles</p>
                </div>
            {% endif %}
        </div>

        <!-- MODAL SIMPLIFICADO -->
        <div id="imageModal" class="modal">
            <span class="close" onclick="closeModal()">&times;</span>
            <img class="modal-content" id="modalImage">
        </div>

        <div class="info">
            <!-- CONTENIDO EN ESPAÑOL -->
            <div id="content-espanol" class="language-content">
                <h2>{{ propiedad.titulo_es }}</h2>
                
                <div class="property-meta">
                    {% if propiedad.ubicacion %}
                    <span><i class="fas fa-map-marker-alt"></i> {{ propiedad.ubicacion }}</span>
                    {% endif %}
                    {% if propiedad.tipo %}
                    <span><i class="fas fa-home"></i> {{ propiedad.tipo|title }}</span>
                    {% endif %}
                </div>
                
                <p class="desc">
                    {% if propiedad.descripcion_es %}
                        {{ propiedad.descripcion_es }}
                    {% else %}
                        Propiedad de calidad en excelente ubicación.
                    {% endif %}
                </p>
                
                {% if propiedad.precio %}
                <p class="price">{{ propiedad.precio }}</p>
                {% endif %}
                
                <!-- BOTONES CORREGIDOS -->
                <div style="display:flex;flex-direction:column;gap:15px;align-items:center;margin-top:25px">
                    {% if propiedad.whatsapp %}
                    <a href="https://wa.me/{{ propiedad.whatsapp }}?text=Hola, estoy interesado en la propiedad: {{ propiedad.titulo_es }}" 
                       target="_blank" class="btn-whatsapp">
                        <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('prospect_form') }}?source=landing&propiedad_id={{ propiedad.id }}" 
                       class="btn-prospecto">
                        <i class="fas fa-envelope"></i> Dejar información
                    </a>
                </div>
            </div>

            <!-- CONTENIDO EN INGLÉS -->
            <div id="content-ingles" class="language-content" style="display:none">
                <h2>{{ propiedad.titulo_en }}</h2>
                
                <div class="property-meta">
                    {% if propiedad.ubicacion %}
                    <span><i class="fas fa-map-marker-alt"></i> {{ propiedad.ubicacion }}</span>
                    {% endif %}
                    {% if propiedad.tipo %}
                    <span><i class="fas fa-home"></i> {{ propiedad.tipo|title }}</span>
                    {% endif %}
                </div>
                
                <p class="desc">
                    {% if propiedad.descripcion_en %}
                        {{ propiedad.descripcion_en }}
                    {% else %}
                        Quality property in excellent location.
                    {% endif %}
                </p>
                
                {% if propiedad.precio %}
                <p class="price">{{ propiedad.precio }}</p>
                {% endif %}
                
                <!-- BOTONES CORREGIDOS -->
                <div style="display:flex;flex-direction:column;gap:15px;align-items:center;margin-top:25px">
                    {% if propiedad.whatsapp %}
                    <a href="https://wa.me/{{ propiedad.whatsapp }}?text=Hello, I'm interested in the property: {{ propiedad.titulo_en }}" 
                       target="_blank" class="btn-whatsapp">
                        <i class="fab fa-whatsapp"></i> Contact via WhatsApp
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('prospect_form') }}?source=landing&propiedad_id={{ propiedad.id }}" 
                       class="btn-prospecto">
                        <i class="fas fa-envelope"></i> Leave contact information
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CÓDIGO OPTIMIZADO - SIN ERRORES
        function setLanguage(lang) {
            showLanguage(lang);
            fetch('/set_language/' + lang).catch(() => {});
        }

        function showLanguage(lang) {
            document.querySelectorAll('.language-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById('content-' + lang).style.display = 'block';
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('btn-' + lang).classList.add('active');
        }

        // MODAL SIMPLIFICADO
        function openModal(img) {
            document.getElementById('modalImage').src = img.src;
            document.getElementById('imageModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // EVENT LISTENERS EFICIENTES
        document.addEventListener('DOMContentLoaded', function() {
            showLanguage('espanol');
            
            document.getElementById('btn-espanol').onclick = () => setLanguage('espanol');
            document.getElementById('btn-ingles').onclick = () => setLanguage('ingles');
            
            // Cerrar modal con ESC
            document.onkeydown = function(e) {
                if (e.key === 'Escape') closeModal();
            };
            
            // Cerrar modal click fuera
            document.getElementById('imageModal').onclick = function(e) {
                if (e.target === this) closeModal();
            };
        });
    </script>
</body>
</html>
