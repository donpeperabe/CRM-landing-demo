{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <!-- ====== CONTENIDO EN ESPAÑOL ====== -->
    <div id="content-espanol" class="language-content">
        <!-- Encabezado del dashboard -->
        <div class="crm-header text-center mb-5">
            <h1><i class="fas fa-building"></i> Sistema CRM Terra Zen</h1>
            <p class="user-welcome">Bienvenido, <strong>{{ user.nombre }}</strong></p>
            <p>Gestiona propiedades y propietarios desde un solo lugar</p>
        </div>

        <!-- Acciones principales -->
        <div class="crm-actions">
            <div class="action-card" onclick="location.href='/crm/propietarios'">
                <div class="action-icon"><i class="fas fa-users"></i></div>
                <h3>Gestionar Propietarios</h3>
                <p>Agrega y administra los propietarios de las propiedades</p>
            </div>

            {% if propietarios %}
            <div class="action-card" onclick="location.href='/crm/propiedades'">
                <div class="action-icon"><i class="fas fa-home"></i></div>
                <h3>Gestionar Propiedades</h3>
                <p>Administra todas las propiedades disponibles</p>
            </div>
            {% else %}
            <div class="action-card" style="opacity:0.5; cursor:not-allowed;"
                onclick="alert('⚠️ Primero debes agregar un propietario antes de gestionar propiedades.');">
                <div class="action-icon"><i class="fas fa-home"></i></div>
                <h3>Gestionar Propiedades</h3>
                <p>Agrega un propietario para habilitar esta función</p>
            </div>
            {% endif %}

            <div class="action-card" onclick="location.href='/prospectos'">
                <div class="action-icon"><i class="fas fa-chart-line"></i></div>
                <h3>Ver Prospectos</h3>
                <p>Revisa los leads y contactos capturados</p>
            </div>
        </div>

        <!-- Propietarios recientes -->
        <div class="propietarios-section">
            <div class="section-title">
                <h2><i class="fas fa-users"></i> Propietarios Registrados</h2>
                <a href="/crm/propietarios" class="btn-primary">
                    <i class="fas fa-plus"></i> Nuevo Propietario
                </a>
            </div>

            {% if propietarios %}
            <div class="propietarios-grid">
                {% for propietario in propietarios %}
                <div class="propietario-card">
                    <div class="propietario-name">{{ propietario.nombre }}</div>
                    {% if propietario.email %}
                    <div class="propietario-info"><i class="fas fa-envelope"></i> {{ propietario.email }}</div>
                    {% endif %}
                    {% if propietario.telefono %}
                    <div class="propietario-info"><i class="fas fa-phone"></i> {{ propietario.telefono }}</div>
                    {% endif %}
                    <div class="propietario-info"><i class="fas fa-calendar"></i> {{ propietario.fecha_registro[:10] }}</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-users"></i>
                <h3>No hay propietarios registrados</h3>
                <p>Comienza agregando tu primer propietario</p>
                <a href="/crm/propietarios" class="btn-primary" style="margin-top: 15px;">
                    <i class="fas fa-plus"></i> Agregar Primer Propietario
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Acciones administrativas -->
        <div class="admin-actions">
            <a href="/propiedades" class="btn-secondary">
                <i class="fas fa-globe"></i> Ver Sitio Público
            </a>
            <a href="/crm/logout" class="btn-secondary">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
            </a>
        </div>
    </div>

    <!-- ====== ENGLISH VERSION ====== -->
    <div id="content-ingles" class="language-content" style="display:none;">
        <!-- Dashboard header -->
        <div class="crm-header text-center mb-5">
            <h1><i class="fas fa-building"></i> Terra Zen CRM System</h1>
            <p class="user-welcome">Welcome, <strong>{{ user.nombre }}</strong></p>
            <p>Manage properties and owners from one place</p>
        </div>

        <!-- Main actions -->
        <div class="crm-actions">
            <div class="action-card" onclick="location.href='/crm/propietarios'">
                <div class="action-icon"><i class="fas fa-users"></i></div>
                <h3>Manage Owners</h3>
                <p>Add and manage property owners</p>
            </div>

            {% if propietarios %}
            <div class="action-card" onclick="location.href='/crm/propiedades'">
                <div class="action-icon"><i class="fas fa-home"></i></div>
                <h3>Manage Properties</h3>
                <p>Administer all available properties</p>
            </div>
            {% else %}
            <div class="action-card" style="opacity:0.5; cursor:not-allowed;"
                onclick="alert('⚠️ You must add an owner before managing properties.');">
                <div class="action-icon"><i class="fas fa-home"></i></div>
                <h3>Manage Properties</h3>
                <p>Add an owner to enable this function</p>
            </div>
            {% endif %}

            <div class="action-card" onclick="location.href='/prospectos'">
                <div class="action-icon"><i class="fas fa-chart-line"></i></div>
                <h3>View Leads</h3>
                <p>Review captured leads and contacts</p>
            </div>
        </div>

        <!-- Recent owners -->
        <div class="propietarios-section">
            <div class="section-title">
                <h2><i class="fas fa-users"></i> Registered Owners</h2>
                <a href="/crm/propietarios" class="btn-primary">
                    <i class="fas fa-plus"></i> New Owner
                </a>
            </div>

            {% if propietarios %}
            <div class="propietarios-grid">
                {% for propietario in propietarios %}
                <div class="propietario-card">
                    <div class="propietario-name">{{ propietario.nombre }}</div>
                    {% if propietario.email %}
                    <div class="propietario-info"><i class="fas fa-envelope"></i> {{ propietario.email }}</div>
                    {% endif %}
                    {% if propietario.telefono %}
                    <div class="propietario-info"><i class="fas fa-phone"></i> {{ propietario.telefono }}</div>
                    {% endif %}
                    <div class="propietario-info"><i class="fas fa-calendar"></i> {{ propietario.fecha_registro[:10] }}</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-users"></i>
                <h3>No owners registered</h3>
                <p>Start by adding your first owner</p>
                <a href="/crm/propietarios" class="btn-primary" style="margin-top: 15px;">
                    <i class="fas fa-plus"></i> Add First Owner
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Admin actions -->
        <div class="admin-actions">
            <a href="/propiedades" class="btn-secondary">
                <i class="fas fa-globe"></i> View Public Site
            </a>
            <a href="/crm/logout" class="btn-secondary">
                <i class="fas fa-sign-out-alt"></i> Log Out
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // IDIOMA - Compatible con tu sistema actual
    function setLanguage(lang) {
        showLanguage(lang);
        // Usar tu sistema de gestión de idiomas
        if (window.languageManager) {
            window.languageManager.setLanguage(lang);
        } else {
            // Fallback: redirigir con parámetro lang
            const url = new URL(window.location.href);
            url.searchParams.set('lang', lang);
            window.location.href = url.toString();
        }
    }

    function showLanguage(lang) {
        document.querySelectorAll('.language-content').forEach(content => {
            content.style.display = 'none';
        });
        const contentElement = document.getElementById('content-' + lang);
        if (contentElement) {
            contentElement.style.display = 'block';
        }
        
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        const btnElement = document.getElementById('btn-' + lang);
        if (btnElement) {
            btnElement.classList.add('active');
        }
    }

    // Inicializar con el idioma actual
    document.addEventListener('DOMContentLoaded', function() {
        // Usar tu sistema de gestión de idiomas
        const currentLang = window.languageManager ? window.languageManager.getCurrentLanguage() : 'espanol';
        showLanguage(currentLang);
    });

    // MODAL SIMPLIFICADO (si lo necesitas)
    function openModal(img) {
        document.getElementById('modalImage').src = img.src;
        document.getElementById('imageModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('imageModal').style.display = 'none';
    }
</script>
{% endblock %}